<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

  <script>
  var config = {
    type: Phaser.AUTO,
    width: 1280,
    height: 720,
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { y: 200 }
      }
    },
    scene: {
      preload: preload,
      create: create
    }
  };

  var game = new Phaser.Game(config)
  var my_address
  var button
  var background
  var dice_result
  var _this

  function preload ()
  {
    this.load.setBaseURL('/');

    this.load.image('sky', 'assets/space3.png');
    this.load.image('logo', 'assets/phaser3-logo.png');
    this.load.image('red', 'assets/red.png');
    this.load.image('button', 'assets/button.png');
    this.load.image('1', 'assets/1.png');
    this.load.image('2', 'assets/2.png');
    this.load.image('3', 'assets/3.png');
    this.load.image('4', 'assets/4.png');
    this.load.image('5', 'assets/5.png');
    this.load.image('6', 'assets/6.png');
    this.load.image('approve', 'assets/approve.png');
    this.load.image('oracle', 'assets/oracle_small/oracle.png');
    this.load.image('crystal_ball', 'assets/oracle_small/crystal_ball.png');
    this.load.image('hand_right', 'assets/oracle_small/hand_right.png');
    this.load.image('hand_left', 'assets/oracle_small/hand_left.png');
    this.load.image('dragonTexture', 'assets/creature/dragon.png');
    this.load.json('dragonMesh', 'assets/creature/dragon.json');
  }

  var dragon = null;

  function create ()
  {
    _this = this

    dice_result = this.add.image(999400, 100, '6');
    
    oracle = this.add.image(650, 290, 'oracle');    
    
    my_address = this.add.text(20, 50, "", { font: "62px Arial Black", fill: "#c51b7d" });
    this.physics.add.existing(my_address);

    my_address.body.setVelocity(100, 200);
    my_address.body.setBounce(1, 1);
    my_address.body.setCollideWorldBounds(true);

    /*
    this.approveBtn = this.add.sprite(600, 500, 'approve').setInteractive();
    this.approveBtn.on('pointerdown', function (event) {
      approve()
    });
    */

    setupLeftHand()
    setupRightHand()


    this.rollBtn = this.add.sprite(650, 520, 'crystal_ball').setInteractive();
    this.rollBtn.on('pointerdown', function (event) {
      roll()
    });
    this.rollBtn.on('pointerover', function (event) {
      console.log(_this.rollBtn)
      _this.rollBtn.scaleX = 1.2
      _this.rollBtn.scaleY = 1.2
      _this.rollBtn.blendMode = "XOR"
    });
    this.rollBtn.on('pointerout', function (event) {
      _this.rollBtn.scaleX = 1.0
      _this.rollBtn.scaleY = 1.0
    });


  }

  function setDice(result)
  {
    dice_result.setTexture(result+1)
    if(result == 5)
      my_address.text = "You win 35 TGN!"
    else
    my_address.text = ""
  }

  function setupLeftHand()
  {
    var floating_range = 40
    var image = _this.add.image(400, 390, 'hand_left');
    var timeline = _this.tweens.createTimeline();
    timeline.loop = -1
    timeline.add({
        targets: image,
        x: image.x,
        y: image.y + floating_range,
        ease: 'Sinusoidal',
        duration: 1500,
        yoyo: true
    });
    timeline.play()
  }

  function setupRightHand()
  {
    var floating_range = 40
    var image = _this.add.image(800, 390-floating_range, 'hand_right');
    var timeline = _this.tweens.createTimeline();
    timeline.loop = -1
    timeline.add({
        targets: image,
        x: image.x,
        y: image.y - floating_range,
        ease: 'Sinusoidal',
        duration: 1500,
        yoyo: true
    });
    timeline.play()
  }
    </script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.5/web3.min.js"></script>
    <script type="text/javascript" src="src/utils.js"></script>
    <script type="text/javascript" src ="src/index.js"></script>
</body>
</html>